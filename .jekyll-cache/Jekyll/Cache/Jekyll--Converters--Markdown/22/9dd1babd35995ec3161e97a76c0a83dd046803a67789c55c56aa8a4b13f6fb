I"ø<h3 id="treasure-nft-marketplace">Treasure NFT marketplace</h3>

<p>ì´ì „ <a href="https://treasure.lol/">TreasureDAO</a> NFT ë§ˆì¼“í”Œë ˆì´ìŠ¤ë¥¼ ì˜ˆì „ì— ë¶„ì„í–ˆë˜ ê²½í—˜ê³¼, ì´ë•Œ ì°¾ì•˜ë˜ ì·¨ì•½ì ì„ ë§í•´ë³´ê³ ì í•œë‹¤. ë˜í•œ, 2022ë…„ 3ì›”ì´ˆì— ì‹¤ì œë¡œ NFT ìì‚°ë“¤ì´ íƒˆì·¨ëœ <a href="https://news.bitcoin.com/attacker-hacks-arbitrums-treasure-dao-for-over-100-nfts-by-leveraging-marketplace-exploit/">ê³µê²©</a>ì— ëŒ€í•´ ì„¤ëª…í•´ë³´ê³ ì í•œë‹¤.</p>

<p>ê¸°ì¡´ ë§ˆì¼“í”Œì´ìŠ¤ì˜ ì „ì²´ ì½”ë“œëŠ” Arbiscanì—ì„œì˜ <a href="https://arbiscan.io/address/0x812cda2181ed7c45a35a691e0c85e231d218e273#code">Contract</a>ì—ì„œ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤. ìš°ì„  ë‚´ê°€ ì²˜ìŒ íŒŒì•…í–ˆë˜ ë¬¸ì œì ì€ NFTë¥¼ ë¦¬ìŠ¤íŒ… í•  ë•Œ ERC721ê³¼ ERC1155ì— ëŒ€í•œ quantity ì²´í¬ë¥¼ ëª…í™•íˆ í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì— ìˆë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ë³´ì.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function</span> <span class="nf">createListing</span><span class="p">(</span>
        <span class="n">address</span> <span class="n">_nftAddress</span><span class="p">,</span>
        <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">,</span>
        <span class="n">uint256</span> <span class="n">_quantity</span><span class="p">,</span>
        <span class="n">uint256</span> <span class="n">_pricePerItem</span><span class="p">,</span>
        <span class="n">uint256</span> <span class="n">_expirationTime</span>
    <span class="p">)</span> <span class="n">external</span> <span class="n">notListed</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">,</span> <span class="n">_tokenId</span><span class="p">,</span> <span class="n">_msgSender</span><span class="p">())</span> <span class="n">onlyWhitelisted</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_expirationTime</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">_expirationTime</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="n">uint256</span><span class="p">).</span><span class="n">max</span><span class="p">;</span>
        <span class="n">require</span><span class="p">(</span><span class="n">_expirationTime</span> <span class="o">&gt;</span> <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="s">"invalid expiration time"</span><span class="p">);</span>
        <span class="n">require</span><span class="p">(</span><span class="n">_quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"nothing to list"</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">IERC165</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">).</span><span class="n">supportsInterface</span><span class="p">(</span><span class="n">INTERFACE_ID_ERC721</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">IERC721</span> <span class="n">nft</span> <span class="o">=</span> <span class="n">IERC721</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">);</span>
            <span class="n">require</span><span class="p">(</span><span class="n">nft</span><span class="p">.</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">_tokenId</span><span class="p">)</span> <span class="o">==</span> <span class="n">_msgSender</span><span class="p">(),</span> <span class="s">"not owning item"</span><span class="p">);</span>
            <span class="n">require</span><span class="p">(</span><span class="n">nft</span><span class="p">.</span><span class="n">isApprovedForAll</span><span class="p">(</span><span class="n">_msgSender</span><span class="p">(),</span> <span class="n">address</span><span class="p">(</span><span class="k">this</span><span class="p">)),</span> <span class="s">"item not approved"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IERC165</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">).</span><span class="n">supportsInterface</span><span class="p">(</span><span class="n">INTERFACE_ID_ERC1155</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">IERC1155</span> <span class="n">nft</span> <span class="o">=</span> <span class="n">IERC1155</span><span class="p">(</span><span class="n">_nftAddress</span><span class="p">);</span>
            <span class="n">require</span><span class="p">(</span><span class="n">nft</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">_msgSender</span><span class="p">(),</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">_quantity</span><span class="p">,</span> <span class="s">"must hold enough nfts"</span><span class="p">);</span>
            <span class="n">require</span><span class="p">(</span><span class="n">nft</span><span class="p">.</span><span class="n">isApprovedForAll</span><span class="p">(</span><span class="n">_msgSender</span><span class="p">(),</span> <span class="n">address</span><span class="p">(</span><span class="k">this</span><span class="p">)),</span> <span class="s">"item not approved"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">revert</span><span class="p">(</span><span class="s">"invalid nft address"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">listings</span><span class="p">[</span><span class="n">_nftAddress</span><span class="p">][</span><span class="n">_tokenId</span><span class="p">][</span><span class="n">_msgSender</span><span class="p">()]</span> <span class="o">=</span> <span class="n">Listing</span><span class="p">(</span>
            <span class="n">_quantity</span><span class="p">,</span>
            <span class="n">_pricePerItem</span><span class="p">,</span>
            <span class="n">_expirationTime</span>
        <span class="p">);</span>

        <span class="n">emit</span> <span class="n">ItemListed</span><span class="p">(</span>
            <span class="n">_msgSender</span><span class="p">(),</span>
            <span class="n">_nftAddress</span><span class="p">,</span>
            <span class="n">_tokenId</span><span class="p">,</span>
            <span class="n">_quantity</span><span class="p">,</span>
            <span class="n">_pricePerItem</span><span class="p">,</span>
            <span class="n">_expirationTime</span>
        <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>
<h3 id="erc721ê³¼-erc1155">ERC721ê³¼ ERC1155</h3>

<p>ì§€ê¸ˆ ì„¤ëª…í•˜ëŠ” ì·¨ì•½ì ë“¤ì€ í˜„ì¬ ë‹¤ ê°œì„ ëœ ìƒíƒœì´ë©°, TreasureDAOëŠ” ì•„ë¹„íŠ¸ëŸ¼ì˜ ëŒ€í‘œ NFT ë§ˆì¼“í”Œë ˆì´ìŠ¤ì¸ <a href="https://trove.treasure.lol">Trove</a>ë¥¼ ìš´ì˜ì¤‘ì´ë‹¤.</p>

<p>Check out the <a href="https://jekyllrb.com/docs/home">Jekyll docs</a> for more info on how to get the most out of Jekyll. File all bugs/feature requests at <a href="https://github.com/jekyll/jekyll">Jekyllâ€™s GitHub repo</a>. If you have questions, you can ask them on <a href="https://talk.jekyllrb.com/">Jekyll Talk</a>.</p>

:ET